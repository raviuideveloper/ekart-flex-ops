<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Ekart Flex</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/custom.css" rel="stylesheet">
</head>
<body onload="getPartnerDetails();">
<nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="index.html"><img src="images/logo.png"></a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
            <ul class="nav navbar-nav flotLeft">
                <!--<li class="dropdown">-->
                    <!--<a href="underConstruction.html" target="_blank" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Partner <span class="caret orangeColor"></span></a>-->
                    <!--<ul class="dropdown-menu">-->
                        <!--<li><a href="underConstruction.html" target="_blank">Partner Center</a></li>-->
                        <!--<li><a href="underConstruction.html" target="_blank">Partner Executive</a></li>-->
                    <!--</ul>-->
                <!--</li>-->
                <li>
                    <a href="searchPartner.html">Partners</a>
                </li>
                <li>
                    <a href="underConstruction.html" target="_blank">Partner Centers</a>
                </li>
                <!--<li class="dropdown">-->
                    <!--<a href="underConstruction.html" target="_blank" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Partner Center<span class="caret orangeColor"></span></a>-->
                    <!--<ul class="dropdown-menu">-->
                        <!--<li><a href="underConstruction.html" target="_blank">Partner</a></li>-->
                        <!--<li><a href="underConstruction.html" target="_blank">Partner Executive</a></li>-->
                    <!--</ul>-->
                <!--</li>-->
                <li class="dropdown">
                    <a href="underConstruction.html" target="_blank" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Partner Executive<span class="caret orangeColor"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="underConstruction.html" target="_blank">Partner Center</a></li>
                        <li><a href="underConstruction.html" target="_blank">Partner Executive</a></li>
                    </ul>
                </li>
                <li>
                    <a><span class="glyphicon glyphicon-user" aria-hidden="true"></span> User Name</a>
                </li>
            </ul>
        </div><!--/.nav-collapse -->
    </div>
</nav>

<!-- Begin page content -->
<div class="container">
    <div class="page-header">
        <div class="col-lg-7 col-md-7 col-sm-6 col-xs-12">
            <h4><span id="partnerName">Partner Name</span> (<span class="linkColor" id="partnerId"></span>)</h4>
            <p><strong>Status: </strong><span id="status">Status</span></p>
        </div>
        <div class="col-lg-5 col-md-5 col-sm-6 col-xs-12">
            <div class="form-horizontal row">
                <label class="col-lg-4 col-md-4 col-sm-5 col-xs-6 control-label">Action :</label>
                <div class="col-lg-5 col-md-5 col-sm-4 col-xs-8">
                    <select class="form-control" id="actions">
                        <option selected value="approved">Approved</option>
                        <option value="rejected">Rejected</option>
                        <option disabled>──────────</option>
                        <option value="edit">Edit</option>
                    </select>
                    <div class="hidediv">
                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                            <button type="button" class="btn orangeBackground whiteColor br0" id="cancelAction">CANCEL</button>
                        </div>
                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                            <button type="button" class="btn orangeBackground whiteColor br0">SAVE</button>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-4 hideOnAction">
                    <button type="button" class="btn orangeBackground whiteColor br0" onclick="onActionCall();">SUBMIT</button>
                </div>
                <div class="clearfix"></div>
                <div class="alerBox mt10" id="showApprovalSuccess">
                    <div class="alert alert-success alert-dismissible" role="alert">
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        Partner has been approved.
                    </div>
                </div>
                <div class="alerBox mt10" id="showRejectedSuccess">
                    <div class="alert alert-warning alert-dismissible" role="alert">
                        Partner has been rejected.
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    </div>
                </div>
                <div class="alerBox mt10" id="apiFail">
                    <div class="alert alert-danger alert-dismissible" role="alert">
                        Something went wrong, please after sometime.
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    </div>
                </div>
            </div>
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="panel panel-default">
        <div class="panel-body">
            <img class="sectionIcon" src="images/bank-title-icon.png"/>
            <p class="ml15">Addresses</p>
            <div class="form-horizontal">
                <label class="col-lg-2 col-md-2 col-sm-2 col-xs-12 control-label">Local Address</label>
                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                    <div class="form-group has-feedback">
                        <textarea class="bodyBackground form-control enableIt br0" id="localAddress" rows="3" disabled></textarea>
                        <span class="glyphicon glyphicon-home form-control-feedback" aria-hidden="true"></span>
                    </div>
                </div>
                <label class="col-lg-2 col-md-2 col-sm-2 col-xs-12 control-label">Permanent Address</label>
                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                    <div class="form-group has-feedback">
                        <textarea class="bodyBackground form-control enableIt br0" id="permanentAddress" rows="3" disabled></textarea>
                        <span class="glyphicon glyphicon-home form-control-feedback" aria-hidden="true"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="panel panel-default">
        <div class="panel-body">
            <img class="sectionIcon" src="images/bank-title-icon.png"/>
            <p class="ml15">Contact Details</p>
            <div class="form-horizontal">
                <label class="col-lg-2 col-md-2 col-sm-2 col-xs-12 control-label">Phone Number</label>
                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                    <div class="form-group has-feedback">
                        <input type="text" class="custom form-control enableIt" id="mobileNumber" placeholder="Contact Number" disabled/>
                        <span class="glyphicon glyphicon-earphone form-control-feedback" aria-hidden="true"></span>
                    </div>
                </div>
                <label class="col-lg-2 col-md-2 col-sm-2 col-xs-12 control-label">Email Id</label>
                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                    <div class="form-group has-feedback">
                        <input type="text" class="custom form-control enableIt" id="emailId" placeholder="Email Id" disabled>
                        <span class="glyphicon glyphicon-envelope form-control-feedback" aria-hidden="true"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="panel panel-default">
        <div class="panel-body">
            <img class="sectionIcon" src="images/bank-title-icon.png"/>
            <p class="ml15">Personal Details</p>
            <div class="form-horizontal">
                <label class="col-lg-2 col-md-2 col-sm-2 col-xs-12 control-label">PAN Number</label>
                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                    <div class="form-group has-feedback">
                        <input type="text" class="custom form-control enableIt" id="panNumber" placeholder="PAN Number" disabled>
                        <span class="glyphicon glyphicon-credit-card form-control-feedback" aria-hidden="true"></span>
                    </div>
                </div>
                <label class="col-lg-2 col-md-2 col-sm-2 col-xs-12 control-label">Service Tax Number</label>
                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                    <div class="form-group has-feedback">
                        <input type="text" class="custom form-control enableIt" id="ServiceNumber" placeholder="Service Tax Number" disabled>
                        <span class="glyphicon glyphicon-credit-card form-control-feedback" aria-hidden="true"></span>
                    </div>
                </div>
                <label class="col-lg-2 col-md-2 col-sm-2 col-xs-12 control-label">Aadhar Card</label>
                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                    <div class="form-group has-feedback">
                        <input type="text" class="custom form-control enableIt" id="aadharNumber" placeholder="Aadhar Card" disabled>
                        <span class="glyphicon glyphicon-credit-card form-control-feedback" aria-hidden="true"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="panel panel-default">
        <div class="panel-body">
            <img class="sectionIcon" src="images/bank-title-icon.png"/>
            <p class="ml15">Bank Details</p>
            <div class="form-horizontal">
                <label class="col-lg-2 col-md-2 col-sm-2 col-xs-12 control-label">Account Holder Name </label>
                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                    <div class="form-group has-feedback">
                        <input type="text" class="custom form-control enableIt" id="accountHolderName" placeholder="Account Holder Name " disabled>
                        <span class="glyphicon glyphicon-user form-control-feedback" aria-hidden="true"></span>
                    </div>
                </div>
                <label class="col-lg-2 col-md-2 col-sm-2 col-xs-12 control-label">Bank Account No </label>
                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                    <div class="form-group has-feedback">
                        <input type="text" class="custom form-control enableIt" id="bankAccount" placeholder="Bank Account No " disabled>
                        <span class="glyphicon glyphicon-list-alt form-control-feedback" aria-hidden="true"></span>
                    </div>
                </div>
                <label class="col-lg-2 col-md-2 col-sm-2 col-xs-12 control-label">Bank Name </label>
                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                    <div class="form-group has-feedback">
                        <input type="text" class="custom form-control enableIt" id="bankName" placeholder="Bank Name " disabled>
                        <span class="glyphicon glyphicon-home form-control-feedback" aria-hidden="true"></span>
                    </div>
                </div>
                <label class="col-lg-2 col-md-2 col-sm-2 col-xs-12 control-label">Branch Name </label>
                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                    <div class="form-group has-feedback">
                        <input type="text" class="custom form-control enableIt" id="branchName" placeholder="Branch Name " disabled>
                        <span class="glyphicon glyphicon-home form-control-feedback" aria-hidden="true"></span>
                    </div>
                </div>
                <label class="col-lg-2 col-md-2 col-sm-2 col-xs-12 control-label">IFSC number </label>
                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                    <div class="form-group has-feedback">
                        <input type="text" class="custom form-control enableIt" id="ifsc" placeholder="IFSC number " disabled>
                        <span class="glyphicon glyphicon-list-alt form-control-feedback" aria-hidden="true"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="panel panel-default">
        <div class="panel-body">
            <img class="sectionIcon" src="images/bank-title-icon.png"/>
            <p class="ml15">Documents</p>
            <div class="table-responsive">
                <table class="table table-bordered table-striped">
                    <thead>
                    <tr class="lightBackground whiteColor">
                        <th>Type</th>
                        <th>Download Document</th>
                    </tr>
                    </thead>
                    <tbody id="documentList"></tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="panel panel-default">
        <div class="panel-body">
            <img class="sectionIcon" src="images/bank-title-icon.png"/>
            <p class="ml15">Status Change History</p>
            <div class="table-responsive">
                <table class="table table-bordered table-striped">
                    <thead>
                    <tr class="lightBackground whiteColor">
                        <th>Status</th>
                        <th>Updated By</th>
                        <th>Date</th>
                    </tr>
                    </thead>
                    <tbody id="partnerList"></tbody>
                </table>
            </div>
            </div>
        </div>
    </div>
</div>

<footer class="footer darkBlueBackground">
    <div class="container">
        <p class="text-muted whiteColor">Ekart Partner, Copyright @ 2016</p>
    </div>
</footer>
<script src="js/jquery-3.1.0.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script>
    $(function() {

        $('#actions').change(function(){
            var selectedOption = $('#actions').val();
            if(selectedOption == 'edit'){
                $('#actions, .hideOnAction').hide();
                $('.hidediv').show();
                $('.enableIt').prop('disabled', false);
                $('#localAddress').focus();
            }
        });
        $('#cancelAction').click(function () {
            $('#actions, .hideOnAction').show();
            $('.hidediv').hide();
            $('.enableIt').prop('disabled', true);
            $('#actions option:eq(0)').prop('selected', true);
            getPartnerDetails();
        })

    });

    function getPartnerDetails() {
        var map = decodeURIComponent(window.location.search.substring(1)).split('?');
        var item1 = map[0];
        var item2 = item1.split('=');
        var partnerIdValue = item2[1];
        $.ajax({
            type: 'GET',
            dataType: 'json',
            url: 'http://ekart-flex-service-apis-alpha-0001.nm.flipkart.com:27035/v1/partner/'+partnerIdValue+'',
            timeout: 5000,
            success: function(data, textStatus ) {
                var partnerData = data.data;

                $('#partnerName').html(partnerData.organization.name);
                $('#partnerId').html(partnerData.organization.id);
                $('#status').html(partnerData.status)
                $('#localAddress').val(partnerData.contact.local_address.address_line1+ ', ' + partnerData.contact.local_address.city + ', ' +
                        partnerData.contact.local_address.state + ', ' + partnerData.contact.local_address.country + ', ' + 'Pincode: ' + partnerData.contact.local_address.pincode );
                $('#permanentAddress').val(partnerData.contact.permanent_address.address_line1 + ', ' + partnerData.contact.permanent_address.city + ', ' +
                        partnerData.contact.permanent_address.state + ', ' + partnerData.contact.permanent_address.country + ', ' + 'Pincode: ' + partnerData.contact.permanent_address.pincode);
                $('#mobileNumber').val(partnerData.contact.mobile);
                $('#emailId').val(partnerData.contact.email);
                $('#panNumber').val(partnerData.organization.pan_number);
                $('#ServiceNumber').val(partnerData.organization.service_tax_number);
                $('#aadharNumber').val();
                $('#accountHolderName').val(partnerData.bank_detail.account_holder_name);
                $('#bankAccount').val(partnerData.bank_detail.bank_account_number);
                $('#bankName').val(partnerData.bank_detail.bank_name);
                $('#branchName').val(partnerData.bank_detail.bank_branch_name);
                $('#ifsc').val(partnerData.bank_detail.bank_ifscnumber);
                var history = partnerData.partner_status_history_details;
                var documentList = partnerData.partner_document_responses;
                var out = "";
                var documents = "";
                for(var i = 0; i < history.length; i++){
                    var date = new Date(history[i].updated_at).toUTCString();
                    date = date.substring(0, date.length - 13);
                    out += "<tr>" +
                            '<td>' + history[i].new_status + '</td>' +
                            '<td>' + history[i].updated_by + '</td>' +
                            "<td>" + date + "</td>" + "</tr>";
                }
                for (var k = 0; k < documentList.length; k++){
                    documents += "<tr>" +
                            '<td>' + documentList[k].partner_document_type_detail.document_type_detail.type + '</td>' +
                            '<td>' + '<a href="#' +documentList[k].d42_url+ '"' + '>' +documentList[k].d42_url + '</a>'+ '</td>' + "</tr>";
                }
                document.getElementById("partnerList").innerHTML = out;
                document.getElementById("documentList").innerHTML = documents;
            },
            error: function(xhr, textStatus, errorThrown){
                console.log('request failed');
            }
        });
    }

    // For Approval and rejection
    function onActionCall() {
        var selectedValue = $('#actions').val();
        var partnerIdValue = $('#partnerId').html();
        var updateByValue = $('#updateBy').html();
        if(selectedValue == 'approved'){
            $.ajax({ method: "POST", url: "http://ekart-flex-service-apis-alpha-0001.nm.flipkart.com:27035/v1/partner/approvePartner",
                headers: {
                    "Content-Type": "application/json"
                },
                data: JSON.stringify({
                    'partner_id' : partnerIdValue,
                    'updated_by': 'updateByValue',
                    'remarks': 'some reason'
                }),
                success: function (e) {
                    $("#showApprovalSuccess").show().delay(5000).fadeOut();
                    $('#status').html("APPROVED");
                },
                error: function (e) {
                    $("#apiFail").show().delay(5000).fadeOut();
                },
                dataType: 'text'
            });
        }else if(selectedValue == 'rejected'){
            $.ajax({ method: "POST", url: "http://ekart-flex-service-apis-alpha-0001.nm.flipkart.com:27035/v1/partner/rejectPartner",
                headers: {
                    "Content-Type": "application/json"
                },
                data: JSON.stringify({
                    'partner_id' : partnerIdValue,
                    'updated_by': 'updateByValue',
                    'remarks': 'some reason'
                }),
                success: function (e) {
                    $("#showRejectedSuccess").show().delay(5000).fadeOut();
                    $('#status').html("REJECTED");
                },
                error: function (e) {
                    $("#apiFail").show().delay(5000).fadeOut();
                },
                dataType: 'text'
            });
        }
    }

</script>
</body>
</html>